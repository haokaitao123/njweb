<template>
  <div class="option-main">
    <Row style="max-height: 420px;overflow-y: auto;"
         id="scrollBox">
      <Form ref="formValidate"
            :model="formValidate"
            :rules="ruleValidate"
            :label-width="100">
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="resuApplypost">
            <Input v-model="formValidate.resuApplypost" placeholder="请输入应聘岗位" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>        <i-col span="11" >
        <FormItem label="应聘岗位" prop="postFname">
          <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
        </FormItem>
      </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>
        <i-col span="11" >
          <FormItem label="应聘岗位" prop="postFname">
            <Input v-model="formValidate.postFname" placeholder="请输入" :disabled="disabled" />
          </FormItem>
        </i-col>






        <i-col span="23">
          <FormItem :label="$t('lang_organization.orgpost.note')"
                    prop="note">
            <Input v-model="formValidate.note"
                   type="textarea"
                   :autosize="{minRows: 2,maxRows: 5}"
                   :placeholder="$t('lang_organization.orgpost.noteInp')"
                   :disabled="disabled" />
          </FormItem>
        </i-col>
      </Form>
    </Row>
    <Button type="primary"
            @click="handleSubmit"
            class="btn"
            v-show="!disabled">{{$t('button.sav')}}</Button>
    <!--弹出选择页面布局 无需变更-->

    <transition name="fade">
      <searchOrgframe v-show="openPick"
                      :searchCloumns="searchCloumns"
                      :params="params"
                      @closeUp="close"
                      @changeinput="changeinput"
                      ref="searchOrgframe"></searchOrgframe>
    </transition>
    <transition name="fade">
      <searchOrgcostcenter v-show="openPick3"
                           :searchCloumns="searchCloumns3"
                           :params="params3"
                           @closeUp="close3"
                           @changeinput="changeinput3"
                           ref="searchOrgcostcenter"></searchOrgcostcenter>
    </transition>
  </div>
</template>
<script>
  import {
    getDataLevelUserLoginSenior,
    getDataLevelUserLogin
  } from "../../../axios/axios";
  import { isSuccess, deepCopy } from "../../../lib/util";
  import searchOrgframe from "../../../components/searchTable/searchOrgframe";
  import searchOrgcostcenter from "../../../components/searchTable/searchOrgcostcenter";
//  引入弹出选择页面
//  import searchCity from '../../../components/searchTable/searchCity'
  export default {
    data () {
      const compareTime = (rule, value, callback) => {
        if (value === "" || !value) {
          callback(new Error("请选择生效日期"));
        } else {
          //开始时间不能大于结束时间   this.formValidate.unitValdate和this.formValidate.unitInvdate  这两个值是根据你当前页面 日期时间绑定的变量
          let startTimeNum = new Date(this.formValidate.postValiddate).getTime();
          let endTimeNum = new Date(this.formValidate.postInvdate).getTime();
          if (startTimeNum > endTimeNum) {
            callback(new Error("生效日期不能大于失效日期"));
          }
          callback();
        }
      }
      return {
        type: '',
        distype: false,
        value: "",
        disabled: false,
        forbidden: null,
        popup: '',
        selectDfpslevel: [],
        selectDfsallevel: [],
        selectDftrvlevel: [],
        selectPostStation: [
          {
            'paramCode': '1',
            'paramInfoCn': '是'
          },
          {
            'paramCode': '0',
            'paramInfoCn': '否'
          },
        ],
        selectseniorityWage: [
          {
            'paramCode': '1',
            'paramInfoCn': '有'
          },
          {
            'paramCode': '0',
            'paramInfoCn': '无'
          },
        ],
        selectpostCostsharing: [
          {
            'paramCode': '1',
            'paramInfoCn': '分摊'
          },
          {
            'paramCode': '0',
            'paramInfoCn': '不分摊'
          },
        ],
        formValidate: {
          _mt: "recruitResume.addOrUpd",
          resuApplypost : '',
          resuIdentity : '',
          resuFilldate : '',
          resuName : '',
          resuIdno : '',
          resuMobile : '',
          resuGender : '',
          resuBirtday : '',
          resuBirtplace : '',
          resuNatality : '',
          resuPolitical : '',
          resuHealthsta : '',
          resuMaritlsta : '',
          resuHeight : '',
          resuWeight : '',
          resuEducat : '',
          resuSchool : '',
          resuProfes : '',
          resuLiving : '',
          resuFamadds : '',
          resuEmernm : '',
          resuEmphone : '',
          resuWithme : '',
          resuSalary : '',
          resuProstatus : '',
          resuAvaitime : '',
          resuIsrelatives : '',
          resuRelatname : '',
          resuRelatdept : '',
          resuIscriminal : '',
          resuIstattoo : '',
          resuApplytype : '',
          resuIntrname : '',
          resuIscom : '',
          resuSelfeval : '',
          resuEnrorage : '',
          resuIsgradu : '',
          resuFinalapptm : '',
          note : '',
          logType: ""
        },
        params: {
          _mt: "orgUnits.getByOrgFramePageList",
          sort: "id",
          order: "desc",
          rows: 10,
          page: 1,
          funId: "1",
          logType: "组织架构查询",
          data: "{}",
          unitPid: 0
        },
        searchCloumns: [
          {
            title: this.$t("lang_organization.orgframe.unitCode"),
            key: "unitCode",
            sortable: "custom"
          },
          {
            title: this.$t("lang_organization.orgframe.compCOrEName"),
            key: "unitFname"
          },
          {
            title: this.$t("lang_organization.orgframe.unitTypeName"),
            key: "unitTypeName"
          }
          //          {
          //            title: '组织类型名称',
          //            key: 'unitDfcostcenterName',
          //            sortable: 'custom',
          //          },
          //          {
          //            title: '组织类型',
          //            key: 'unitDfcostcenter',
          //            sortable: 'custom',
          //          },
        ],
        params3: {
          _mt: "orgCostcenter.getPage",
          sort: "id",
          order: "desc",
          rows: 10,
          page: 1,
          funId: "1",
          logType: "成本中心查询",
          data: "{}"
        },
        searchCloumns3: [
          {
            title: this.$t("lang_organization.orgcostcenter.costCode"),
            key: "costCode",
            sortable: "custom"
          },
          {
            title: this.$t("lang_organization.orgcostcenter.cname"),
            key: "cname"
          },
          {
            title: this.$t("lang_organization.orgcostcenter.ename"),
            key: "ename"
          }
        ],
        //设置必填规则
        ruleValidate: {
          // postCode: [
          //   {
          //     required: true,
          //     message: this.$t("lang_organization.orgpost.postCodeInp"),
          //     trigger: "blur"
          //   }
          // ],
          postFname: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postFnameCnDisInp"),
              trigger: "blur"
            }
          ],
          postStation: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postStationInp"),
              trigger: "change"
            }
          ],
          seniorityWage: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.seniorityWageInp"),
              trigger: "blur"
            }
          ],
          postCostsharing: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postCostsharingInp"),
              trigger: "blur"
            }
          ],
          postTrialsalary: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postTrialsalaryInp"),
              type: 'number',
              trigger: "change"
            }
          ],
          postStansalary: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postStansalaryInp"),
              type: 'number',
              trigger: "change"
            }
          ],
          postDfpslevel: [
            {
              required: true,
              message: this.$t("lang_organization.orgpost.postDfpslevelInp"),
              trigger: "blur"
            }
          ],
          //在验证规则里 加上你对应的日期验证
          //unitValdate 这个变量对应你页面标签里的prop属性名  <FormItem label="生效日期" prop="unitValdate"> ，
          postValiddate: [
            {
              required: true,
              type: "date",
              validator: compareTime,
              trigger: "change"
            }
          ],
        }
      };
    },
    //    子页面默认参数 无需变更
    props: {
      id: Number,
      logType: String,
      index: Number,
    },
    components: {
      searchOrgframe,
      searchOrgcostcenter
    },
    updated () { },
    mounted () {
      this.getSelect();
    },
    methods: {

      getData (id) {
        const t = this;
        this.page = 1;
        getDataLevelUserLogin({
          _mt: "recruitResume.getById",
          id: id,
          funId: "1",
          logType: "Id查询"
        })
          .then(res => {
            if (isSuccess(res, t)) {
              t.formValidate.resuApplypost = res.data.content[0].resuApplypost;
              t.formValidate.resuIdentityDis = res.data.content[0].postCode;
              t.formValidate.resuFilldate = res.data.content[0].postCode;
              t.formValidate.resuName = res.data.content[0].postCode;
              t.formValidate.resuIdno = res.data.content[0].postCode;
              t.formValidate.resuMobile = res.data.content[0].postCode;
              t.formValidate.resuGenderDis = res.data.content[0].postCode;
              t.formValidate.resuBirtday = res.data.content[0].postCode;
              t.formValidate.resuBirtplace = res.data.content[0].postCode;
              t.formValidate.resuNatalityDis = res.data.content[0].postCode;
              t.formValidate.resuPoliticalDis = res.data.content[0].postCode;
              t.formValidate.resuHealthstaDis = res.data.content[0].postCode;
              t.formValidate.resuMaritlstaDis = res.data.content[0].postCode;
              t.formValidate.resuHeight = res.data.content[0].postCode;
              t.formValidate.resuWeight = res.data.content[0].postCode;
              t.formValidate.resuEducatDis = res.data.content[0].postCode;
              t.formValidate.resuSchool = res.data.content[0].postCode;
              t.formValidate.resuProfes = res.data.content[0].postCode;
              t.formValidate.resuLiving = res.data.content[0].postCode;
              t.formValidate.resuFamadds = res.data.content[0].postCode;
              t.formValidate.resuEmernm = res.data.content[0].postCode;
              t.formValidate.resuEmphone = res.data.content[0].postCode;
              t.formValidate.resuWithmeDis = res.data.content[0].postCode;
              t.formValidate.resuSalary = res.data.content[0].postCode;
              t.formValidate.resuProstatusDis = res.data.content[0].postCode;
              t.formValidate.resuAvaitime = res.data.content[0].postCode;
              t.formValidate.resuIsrelativesDis = res.data.content[0].postCode;
              t.formValidate.resuRelatname = res.data.content[0].postCode;
              t.formValidate.resuRelatdept = res.data.content[0].postCode;
              t.formValidate.resuIscriminalDis = res.data.content[0].postCode;
              t.formValidate.resuIstattooDis = res.data.content[0].postCode;
              t.formValidate.resuApplytypeDis = res.data.content[0].postCode;
              t.formValidate.resuIntrname = res.data.content[0].postCode;
              t.formValidate.resuIscomDis = res.data.content[0].postCode;
              t.formValidate.resuSelfeval = res.data.content[0].postCode;
              t.formValidate.resuEnrorageDis = res.data.content[0].postCode;
              t.formValidate.resuIsgraduDis = res.data.content[0].postCode;
              t.formValidate.resuFinalapptm = res.data.content[0].postCode;
              t.formValidate.note = res.data.content[0].postCode;
              t.formValidate.postCode = res.data.content[0].postCode;
            }
          })
          .catch(() => {
            this.$Modal.error({
              title: this.$t("reminder.err"),
              content: this.$t("reminder.errormessage")
            });
          });
      },

      updateimg () {
        this.updateImg = true;
      },
      closeImg () {
        const t = this;
        t.updateImg = false;
      },
      getSelect () {
        const t = this;
        getDataLevelUserLogin({
          _mt: "baseParmInfo.getSelectValue",
          typeCode: "postlevel,salarylevel,travellevel"
        })
          .then(res => {
            if (isSuccess(res, t)) {
              t.selectDfpslevel = res.data.content[0].value[0].paramList;
              t.selectDfsallevel = res.data.content[0].value[1].paramList;
              t.selectDftrvlevel = res.data.content[0].value[2].paramList;
            }
          })
          .catch(() => {
            this.$Modal.error({
              title: this.$t("reminder.err"),
              content: this.$t("reminder.errormessage")
            });
          });
      },
      render1 () {
        this.$Modal.confirm({
          ref: "imgEdit",
          onOk: () => {
            const formData = new FormData(document.getElementById("fileinput1"));
            uploadimage(formData)
              .then(res => {
                alert(res);
              })
              .catch(res => {
                alert(res);
              });
          },
          attrs: {
            id: "foo"
          },
          render: h => {
            return h(imgEdit, {
              props: {
                value: this.value
              },
              on: {
                change: val => {
                  this.value = val;
                }
              }
            });
          }
        });
      },
      handleSubmit () {
        const t = this;
        const data = deepCopy(t.formValidate);
        data.logType = t.logType;

        if (t.logType === this.$t("button.upd")) {
          data.id = t.id;
        }
        if (data.postValiddate !== undefined) {
          data.postValiddate = new Date(data.postValiddate).format("yyyy-MM-dd");
        }
        if (data.postInvdate !== undefined) {
          data.postInvdate =
            data.postInvdate === ""
              ? ""
              : new Date(data.postInvdate).format("yyyy-MM-dd");
        }
        this.$refs.formValidate.validate(valid => {
          if (valid) {
            getDataLevelUserLoginSenior(data)
              .then(res => {
                if (isSuccess(res, t)) {

                  t.$emit("closeUp");
                  if (t.logType === this.$t("button.add")) {
                    t.$Modal.success({
                      title: this.$t("reminder.suc"),
                      content: this.$t("reminder.addsuccess")
                    });
                    t.$refs.formValidate.resetFields();
                    t.$emit("getData", res.data.content[0]);
                  } else {
                    t.$Modal.success({
                      title: this.$t("reminder.suc"),
                      content: this.$t("reminder.updsuccess")
                    });
                    console.log(res, "res")
                    t.$emit("update", res.data.content[0]);
                  }
                }
              })
              .catch(() => {
                this.$Modal.error({
                  title: this.$t("reminder.err"),
                  content: this.$t("reminder.errormessage")
                });
              });
          }
        });
      },
      close () {
        const t = this;
        t.openPick = false;
      },
      close2 () {
        const t = this;
        t.openPick2 = false;
      },
      close3 () {
        const t = this;
        t.openPick3 = false;
      },
      changeinput (name, id, costname, costid) {
        const t = this;
        t.postUnitName = name;
        t.formValidate.postUnit = id;
        t.postDfcostcenterName = costname;
        t.formValidate.postDfcostcenter = costid;
      },
      changeinput3 (name, id) {
        const t = this;
        t.postDfcostcenterName = name;
        t.formValidate.postDfcostcenter = id;
      },
      pickData () {
        const t = this;
        t.$refs.searchOrgframe.getData(this.params);
        t.openPick = true;
      },
      pickData2 () {
        if (this.forbidden === null && !this.disabled) {
          const t = this
          t.$refs.searchOrgframe.getData(this.params2)
          t.openPick2 = true
        }
      },
      pickData3 () {
        const t = this;
        t.$refs.searchOrgcostcenter.getData(this.params3);
        t.openPick3 = true;
      },
      clearPid () {
        const t = this;
        t.postUnitName = "";
        t.formValidate.postUnit = "";
      },
      clearDfhire () {
        if (!this.disabled) {
          const t = this
          t.unitCityName = ''
          t.formValidate.unitCity = ''
        }
      },
      clearCostcenter () {
        const t = this;
        t.postDfcostcenterName = "";
        t.formValidate.postDfcostcenter = "";
      },
    },
    watch: {}
  };
</script>
<style lang="scss" scoped>
  @import "../../../sass/updateAndAdd";
  .option-main {
    position: relative;
    height: 500px;
    .btn {
      position: absolute;
      bottom: 20px;
      right: 40px;
    }
    .btn1 {
      position: absolute;
      bottom: 20px;
      right: 100px;
    }
  }
</style>
